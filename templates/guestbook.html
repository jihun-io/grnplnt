{% extends 'layout.html' %} {% block content %}
<section class="qna-wrapper">
  <div class="title">
    <h2>방명록</h2>
  </div>

  <script
    src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback"
    defer
  ></script>
  <script>
    function turnstileCheck() {
      turnstile = document.querySelectorAll('input[id ^= "cf-chl-widget-"]');
      if (turnstile[0].value == "") {
        return false;
      } else {
        return true;
      }
    }
  </script>

  <form
    id="write"
    method="post"
    action="./guestbook/submit"
    onsubmit="return turnstileCheck()"
    class="write-area"
  >
    <div class="userinfo">
      <input
        type="text"
        id="name"
        name="username"
        placeholder="이름"
        maxlength="32"
        required
      />
      <input
        type="password"
        id="pw"
        name="password"
        placeholder="비밀번호"
        minlength="4"
        required
      />
    </div>
    <textarea name="content" form="write" required></textarea>
    <div class="write-btn">
      <div
        class="cf-turnstile"
        data-size="compact"
        data-sitekey="0x4AAAAAAAh5X07CUer4bS3L"
      ></div>
      <input type="submit" class="guestbook-submit" />
    </div>
  </form>
  <div class="guestbook-list">
    {% for post in posts %}
    <div id="{{ post[3] }}" class="guestbook-post">
      <div class="guestbook-post-info">
        <div class="guestbook-post-namedate">
          <div class="guestbook-post_name">
            <p>{{ post[0] }}</p>
          </div>
          <div class="guestbook-post-date">
            <p>{{ post[1] }}</p>
          </div>
        </div>
        <div class="more">
          <button onclick="editDropdown({{ post[3] }})">
            <i class="fas fa-ellipsis-v"></i>
          </button>
        </div>
      </div>
      <div class="guestbook-post-input" id="edit{{ post[3] }}">
        <form id="editform{{ post[3] }}" method="post">
          <input
            class="pw-input"
            type="password"
            id="pw_edit{{ post[3] }}"
            name="pw_edit"
            placeholder="비밀번호"
          />
          <input
            type="submit"
            class="edit-submit"
            value="편집"
            onclick="editPost({{ post[3] }}, 0)"
          />
          <input
            type="submit"
            class="del-submit"
            value="삭제"
            onclick="editPost({{ post[3] }}, 1)"
          />
        </form>
      </div>
      <div class="guestbook-post-content">
        <p>{{ post[2] }}</p>
      </div>
    </div>
    {% if not loop.last %}
    <hr />
    {% endif %} {% endfor %}
  </div>
  <script>
    function editDropdown(num) {
      var dropdownList = document.getElementById("edit" + num);
      if (dropdownList.classList.contains("open")) {
        dropdownList.classList.remove("open");
      } else {
        dropdownList.classList.add("open");
      }
    }

    function editPost(num, edit) {
      var form = document.getElementById("editform" + num);
      if (edit == 0) {
        form.action = "./guestbook/edit?id=" + num;
      } else if (edit == 1) {
        form.action = "./guestbook/del?id=" + num;
      } else {
      }
    }
  </script>
</section>
{% endblock %}
